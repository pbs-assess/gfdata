<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using 'get_all' functions • gfdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using 'get_all' functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gfdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gfdata-vignette-get-all.html">Using 'get_all' functions</a></li>
    <li><a class="dropdown-item" href="../articles/gfdata-vignette.html">Introduction to gfdata</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbs-assess/gfdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using 'get_all' functions</h1>
                        <h4 data-toc-skip class="author">Philina
English</h4>
            
            <h4 data-toc-skip class="date">2024-10-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pbs-assess/gfdata/blob/master/vignettes/gfdata-vignette-get-all.Rmd" class="external-link"><code>vignettes/gfdata-vignette-get-all.Rmd</code></a></small>
      <div class="d-none name"><code>gfdata-vignette-get-all.Rmd</code></div>
    </div>

    
    
<style type="text/css">
  body{
  font-size: 11pt;
}
</style>
<div class="section level2">
<h2 id="why-use-a-get_all_-function">Why use a <code>get_all_*()</code> function?<a class="anchor" aria-label="anchor" href="#why-use-a-get_all_-function"></a>
</h2>
<p>The original <code>get_*()</code> survey functions are limited to
returning sets and specimen samples that conform to current survey
design specifications based on assigned grouping and usability codes.
This works well for some surveys and data uses that depend on sampling a
consistent survey footprint across years such as generating design-based
abundance indexes. Other uses can harness information from samples that
were collected outside the current survey footprint or from different
types of surveys, some of which don’t consistently apply these codes.
The <code>get_all_*()</code> functions have been designed to retrieve
all fishery-independent survey data relevant to a particular species, or
set of species, and to do so more quickly and comprehensively than the
original functions. When retrieving data for multiple species at once,
these functions will be dramatically faster than the original
<code>get_*()</code> functions. This is because sql scripts are called
once for all species rather than repeatedly for each species. When
retrieving data for single species run times will depend on which
surveys and arguments are used. The extent of the data returned can be
specific to a single survey, a single major stat area, any combination
of these, or generalized to get everything in the database that is
appropriately formatted.
<!-- Currently, Nearshore Shrimp trawl and IPES survey data are not available.  -->
Additional variables are also returned to support modelling objectives
and decisions regarding which data should be retained for specific
purposes.</p>
<div class="section level3">
<h3 id="more-flexibility">More flexibility<a class="anchor" aria-label="anchor" href="#more-flexibility"></a>
</h3>
<p>The original functions required the user to specify survey series ids
(<code>ssid</code>) and were limited in which they could accept and
return.
<!-- They were primarily designed to pull the contemporary synoptic trawl surveys (`ssid = c(1, 3, 4, 16)`), the historic Hecate Strait Multispecies Assemblage trawl survey (`ssid = c(2)`), IPHC (`ssid = c(14)`), and four Hard Bottom Longline surveys (`ssid = c(22, 36, 39, 40)`). -->
For <code>get_all_*()</code> functions, we have the option to set
<code>ssid = NULL</code> which will return all fishery-independent
samples and catch data in the database, as long as the survey series ids
(and for catch data, survey ids as well) have been assigned in the
database. These include trap (sablefish), longline, jig, and most
contemporary and historic trawl surveys (exceptions include the
Nearshore Shrimp trawl survey for which survey ids are missing). If a
character string of major stat area codes is provided to the argument
<code>major</code>, than all sets or samples from that area will be
returned.</p>
</div>
<div class="section level3">
<h3 id="design-based-analyses">Design-based analyses<a class="anchor" aria-label="anchor" href="#design-based-analyses"></a>
</h3>
<p>Because the original <code>get_*()</code> survey functions were
intended to only return sets and specimen samples that conform to
current survey design specifications, they cannot retrieve sets and
samples from cells that fall outside the latest definition of a
particular survey’s design. When this behaviour is desired, it can be
reproduced using the <code>get_all_*()</code> functions with the
filtering options <code>usability = c(0, 1, 2, 6)</code> and
<code>grouping_only = TRUE</code>. This works reliably for most
groundfish bottom trawl and longline surveys
(<code>ssid = c(1, 2, 3, 4, 16, 22, 36, 39, 40)</code>). However, when
these filtering options are applied to certain surveys, a small
proportion of the data returned by the original function may be missed
(e.g., IPHC: <code>ssid = 14</code>) and no data is returned for surveys
for which grouping or usability codes do not appear in the database
(e.g., the jig survey: <code>ssid = c(82:87)</code>).</p>
<p>If using the <code>get_all_*()</code> functions to generate
design-based indices, the strata area variable is now called
<code>grouping_area_km2</code> (instead of <code>area_km2</code> to
avoid confusion with <code>area_swept*</code> variables) and, in case
design changes occur that are not incorporated into the usability codes,
one should also always check for differences between the
<code>grouping_code</code> and <code>grouping_code_updated</code>
variables. The <code>grouping_code_updated</code> generally contains a
subset of the former, likely as a result of a shrinking footprint or the
dropping an entire strata from a survey’s definition. This is currently
the case for the offshore shrimp, also known as multi-species small-mesh
(MSSM), surveys (<code>ssid = c(6, 7)</code>), which needs to be
filtered for only those sets with updated grouping codes
(<code>!is.na(grouping_code_updated)</code>) in order to match the
current survey design. Consulting data stewards for specific surveys may
be helpful in understanding differences between grouping codes.</p>
<p>To retrieve specimen samples that conform to design specifications,
the arguments <code>unsorted_only = TRUE</code> and
<code>random_only = TRUE</code> should be used in addition to usability
and grouping options. When doing so
<code><a href="../reference/get_all.html">get_all_survey_samples()</a></code> function will return &gt; 70
additional specimens over the original function for each of the longline
surveys (<code>ssid = c(22, 36, 39, 40)</code>). This is because the
original <code><a href="../reference/get_data.html">get_survey_samples()</a></code> function used a stricter
method for filtering based on grouping codes. This stricter filtering
matches how <code><a href="../reference/get_data.html">get_survey_sets()</a></code> filtered for the current
trawl survey footprint, but not how it filtered sets for longline
surveys. If desired, this stricter filtering can be achieved for both
sets and samples from any survey by filtering for
<code>!is.na(grouping_code_updated)</code>.</p>
</div>
<div class="section level3">
<h3 id="non-standard-data">Non-standard data<a class="anchor" aria-label="anchor" href="#non-standard-data"></a>
</h3>
<!-- Their default settings also exclude tows that are shorter than the standard length.  -->
<p>In contrast, the default behaviour of the <code>get_all_*()</code>
survey functions is to return all data collected on any given survey,
whether or not it conforms to current design. This includes sets and
samples from grid cells that all within subsequently established
Rockfish Conservation areas (RCAs), and data that differ at the skate
level. The original functions were not built to retrieve data that
differed at the skate level, like gear comparison studies (e.g.,
<code>ssid = 48</code>). The <code>get_all_*()</code> functions will
automatically return catch information at the skate level, instead of
the fishing event level, for sets within a single function call whenever
gear variables (currently checking for differences in hook code and
size) differ between skates.</p>
</div>
</div>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>If you don’t already have the package installed, see the general
gfdata vignette for instructions. Here we will load gfdata along with
the package dplyr.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbs-assess/gfdata" class="external-link">gfdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></code></pre></div>
<p>The available arguments are described in the help documentation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu"><a href="../reference/get_all.html">get_all_survey_sets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="fu"><a href="../reference/get_all.html">get_all_survey_samples</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="what-survey-data-is-available-for-a-species">What survey data is available for a species?<a class="anchor" aria-label="anchor" href="#what-survey-data-is-available-for-a-species"></a>
</h3>
<p>As an example, we might want to determine what survey set data are in
our database for Bluntnose Sixgill Sharks (<em>Hexanchus griseus</em>).
For now, we will leave the default settings that pull all surveys and
all areas. Beware that some records in the database are from outside
Canadian waters. If desired, returned data can be filtered using the
<code>major_stat_area_code</code> to retain only Canadian records (see
<code><a href="../reference/lookup.html">get_major_areas()</a></code> to identify which codes to use).</p>
<div class="section level4">
<h4 id="original-get_survey_sets-function">Original <code>get_survey_sets()</code> function<a class="anchor" aria-label="anchor" href="#original-get_survey_sets-function"></a>
</h4>
<p>To start with, we check what the original
<code><a href="../reference/get_data.html">get_survey_sets()</a></code> function returns for this species. By
default this function returns just the most commonly used groundfish
surveys: synoptic trawl (<code>ssid = c(1, 3, 4, 16)</code>), one
historical trawl (<code>2</code>), and five longline–IPHC
(<code>14</code>) and PHMA (<code>22, 36, 39, 40</code>) surveys. The
first thing to note here is that this function will only return one row
per fishing event (unless overlapping survey series or sample_ids were
requested). This function will also return all sets for any survey
series, even when the species has never been recorded on that
survey.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_survey_sets</a></span><span class="op">(</span><span class="st">"Bluntnose Sixgill Shark"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d0</span><span class="op">)</span> <span class="co">#&gt; number of rows</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 15349</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d0</span><span class="op">$</span><span class="va">fishing_event_id</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; number of fishing events</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 15349</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d0</span><span class="op">$</span><span class="va">survey_series_id</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; all default survey series were returned</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1]  1  2  3  4 14 16 22 36 39 40</span></span></code></pre>
<p>In contrast, <code><a href="../reference/get_all.html">get_all_survey_sets()</a></code> only returns set data
for survey series that have captured the species at least once. Both
<code>*_survey_sets()</code> functions return all sets for any survey
series returned, including those that did not record the species. So, to
make sets that did capture the species visible to <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code>,
we will sort by descending <code>catch_count</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="va">d0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fishing_event_id</span>, <span class="va">catch_count</span>, <span class="va">catch_weight</span>, <span class="va">ssid</span>, <span class="va">survey_abbrev</span>,</span>
<span>           <span class="va">survey_series_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">catch_count</span>, <span class="op">-</span><span class="va">fishing_event_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d0</span>, n <span class="op">=</span> <span class="fl">8L</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 8 x 36</span></span>
<span><span class="co">#&gt;    year fishing_event_id catch_count catch_weight  ssid survey_abbrev survey_series_desc   survey_id</span></span>
<span><span class="co">#&gt;   &lt;int&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;                    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2018          5092608          24            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 2  2018          5087665          14            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 3  2018          5093313          13            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 4  2018          5089779          10            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 5  2018          5074269          10            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 6  2018          5090481           9            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 7  2018          5074976           8            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; 8  2018          5091185           6            0    14 IPHC FISS     International Pacif~       538</span></span>
<span><span class="co">#&gt; # i 28 more variables: species_code &lt;chr&gt;, survey_desc &lt;chr&gt;, trip_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   fe_major_level_id &lt;dbl&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, grouping_code &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   major_stat_area_code &lt;chr&gt;, minor_stat_area_code &lt;chr&gt;, depth_m &lt;dbl&gt;, duration_min &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   doorspread_m &lt;dbl&gt;, speed_mpm &lt;dbl&gt;, tow_length_m &lt;dbl&gt;, density_kgpm2 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   density_pcpm2 &lt;dbl&gt;, skate_count &lt;int&gt;, hook_count &lt;int&gt;, density_ppkm2 &lt;dbl&gt;, month &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   day &lt;int&gt;, time_deployed &lt;dttm&gt;, time_retrieved &lt;dttm&gt;, latitude_end &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   longitude_end &lt;dbl&gt;, species_common_name &lt;chr&gt;, species_science_name &lt;chr&gt;, ...</span></span></code></pre>
<p>Notice that <code>catch_weight</code> sometimes contains zeros when
<code>catch_count</code> is at least 1. This is because the original SQL
code assume NULL values to be zeros. In many cases catch weights are
missing because they are not collected on that type of survey. However,
even for surveys where weights are the usual unit of measurement, a
particular catch may have been too large or small for the scale and
therefore recorded only as a count. For
<code><a href="../reference/get_all.html">get_all_survey_sets()</a></code>, the default setting is
<code>remove_false_zeros = TRUE</code>, which removes these misleading
zeros from the data.</p>
</div>
<div class="section level4">
<h4 id="using-get_all_survey_sets">Using <code>get_all_survey_sets()</code><a class="anchor" aria-label="anchor" href="#using-get_all_survey_sets"></a>
</h4>
<p>Messages and warnings will alert the user about nuances in the data
requested and returned. For example, this function call results in
multiple rows of data that share the same fishing_event_id and a warning
that suggests possible reasons for this. In this case, the number of
rows of data exceeds the number of fishing events because catch is being
returned at the skate level for some fishing events. This will happen
any time skates within a fishing event differ in their gear (currently
just working off differences in hook type and size).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_all.html">get_all_survey_sets</a></span><span class="op">(</span><span class="st">"Bluntnose Sixgill Shark"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "Returning all sets/events/skates (including those with no catch) from all survey series that recorded Bluntnose Sixgill Shark at least once."</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning in get_all_survey_sets("Bluntnose Sixgill Shark"): Duplicate fishing_event_ids are still</span></span>
<span><span class="co">#&gt; present despite `remove_duplicates = TRUE`. This may be because of overlapping survey</span></span>
<span><span class="co">#&gt; stratifications or multiple skates per event (specifically when at least one survey included used</span></span>
<span><span class="co">#&gt; skates with differences in gear type), but could also be due to trips participating in more than</span></span>
<span><span class="co">#&gt; one type of survey. If the latter, location, gear, or `reason_desc` columns should be used to</span></span>
<span><span class="co">#&gt; choose which events to keep. After selecting specific survey stratifications and determining that</span></span>
<span><span class="co">#&gt; all relevant variables are accurate, the remaining duplications can be filtered using `dat &lt;-</span></span>
<span><span class="co">#&gt; dat[!duplicated(dat$fishing_event_id), ]`.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning in get_all_survey_sets("Bluntnose Sixgill Shark"): All sablefish research related sets are</span></span>
<span><span class="co">#&gt; returned as survey_series_id 35. To separate types of sets, use reason_desc and grouping_code</span></span>
<span><span class="co">#&gt; variables.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="co">#&gt; number of rows</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 18967</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">fishing_event_id</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; number of fishing events</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 18840</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">survey_series_id</span><span class="op">)</span><span class="op">)</span> <span class="co">#&gt; only returns survey series that caught the species</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1]  4  6  7 14 34 35 36 39 40 45 48 76 80</span></span></code></pre>
<p>Now, when we view the data <code>catch_weight</code> appears
appropriately as <code>NA</code> when this data was not collected. We
now also get catches at the skate level (multiple skates make up each
fishing event) for the dogfish comparison work
(<code>ssid = c(48)</code>) which was not (and cannot be) returned by
<code><a href="../reference/get_data.html">get_survey_sets()</a></code> due to the gear differences between
skates.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fishing_event_id</span>, <span class="va">catch_count</span>, <span class="va">catch_weight</span>, <span class="va">ssid</span>, <span class="va">survey_abbrev</span>,</span>
<span>           <span class="va">activity_desc</span>, <span class="va">skate_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">catch_count</span>, <span class="op">-</span><span class="va">fishing_event_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span>, n <span class="op">=</span> <span class="fl">8L</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 8 x 75</span></span>
<span><span class="co">#&gt;    year fishing_event_id catch_count catch_weight  ssid survey_abbrev activity_desc         skate_id</span></span>
<span><span class="co">#&gt;   &lt;int&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;                    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2018          5092608          24           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 2  2018          5087665          14           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 3  2018          5093313          13           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 4  2018          5089779          10           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 5  2018          5074269          10           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 6  2018          5090481           9           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 7  2018          5074976           8           NA    14 IPHC FISS     INTERNATIONAL PACIFI~       NA</span></span>
<span><span class="co">#&gt; 8  2023          5795618           6           NA    48 OTHER         DOGFISH GEAR/TIMING ~  5788696</span></span>
<span><span class="co">#&gt; # i 67 more variables: species_common_name &lt;chr&gt;, species_code &lt;chr&gt;, fe_major_level_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   trip_id &lt;dbl&gt;, survey_series_og &lt;dbl&gt;, survey_id &lt;int&gt;, activity_code &lt;dbl&gt;, reason_desc &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   trip_year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, time_deployed &lt;dttm&gt;, time_retrieved &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   time_end_deployment &lt;dttm&gt;, time_begin_retrieval &lt;dttm&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   latitude_end &lt;dbl&gt;, longitude_end &lt;dbl&gt;, major_stat_area_code &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   minor_stat_area_code &lt;chr&gt;, depth_m &lt;dbl&gt;, depth_begin &lt;dbl&gt;, depth_end &lt;dbl&gt;, vessel_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   captain_id &lt;dbl&gt;, duration_min &lt;int&gt;, tow_length_m &lt;dbl&gt;, mouth_width_m &lt;dbl&gt;, ...</span></span></code></pre>
<p>So, which surveys encountered the most of this species? Some surveys
only count individuals and others only weigh the total catch, so we will
summarize both count and weight variables.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ssid</span>, <span class="va">survey_series_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>event_skate_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fishing_event_id</span>, <span class="st">"-"</span>, <span class="va">skate_id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>individuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">catch_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">catch_weight</span><span class="op">)</span>,</span>
<span>            events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fishing_event_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            skates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">event_skate_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">individuals</span>, <span class="op">-</span><span class="va">weight</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 13 x 7</span></span>
<span><span class="co">#&gt; # Groups:   ssid [13]</span></span>
<span><span class="co">#&gt;     ssid survey_series_desc                                   individuals weight events skates  rows</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;                                                      &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1    14 "International Pacific Halibut Commission Fishery-I~         175  NA      3278   3278  3278</span></span>
<span><span class="co">#&gt;  2    48 "Dogfish Gear/Timing Comparison Surveys"                      38  NA       145    271   271</span></span>
<span><span class="co">#&gt;  3    40 "Hard Bottom Longline Inside South "                          16  NA       528    528   528</span></span>
<span><span class="co">#&gt;  4    76 "Strait of Georgia Dogfish Longline"                          13  NA       351    351   351</span></span>
<span><span class="co">#&gt;  5    45 "Strait of Georgia Synoptic Bottom Trawl"                      2  19.4      98     98    98</span></span>
<span><span class="co">#&gt;  6    39 "Hard Bottom Longline Inside North "                           1 200       769    769   769</span></span>
<span><span class="co">#&gt;  7    34 "Strait of Georgia Ecosystem Research Initiative Ac~           1  36.7     167    167   167</span></span>
<span><span class="co">#&gt;  8     6 "Queen Charlotte Sound Multispecies Small-mesh Bott~           1   7.14   1295   1295  1295</span></span>
<span><span class="co">#&gt;  9    35 "Sablefish Research and Assessment"                            1   5.8    3582   3582  3582</span></span>
<span><span class="co">#&gt; 10     4 "West Coast Vancouver Island Synoptic Bottom Trawl"            1   1.52   1737   1737  1737</span></span>
<span><span class="co">#&gt; 11    36 "Hard Bottom Longline Outside South"                           1  NA      1536   1536  1536</span></span>
<span><span class="co">#&gt; 12     7 "West Coast Vancouver Island Multispecies Small-mes~           0  15.7    5084   5084  5084</span></span>
<span><span class="co">#&gt; 13    80 "Eulachon Migration Study Bottom Trawl (South)"                0   4.5     271    271   271</span></span></code></pre>
<p>We can also tally the number of unique fishing events versus the
number of rows of data returned to see which surveys have been returned
at the skate level. This was the case for SSID <code>48</code>.</p>
<p>The vast majority of records for Bluntnose Sixgill Shark come from
the IPHC, followed by the Dogfish and Hard Bottom Longline surveys, both
conducted in the Strait of Georgia (aka. Inside South). Because the IPHC
covers a wider area, we can explore the spatial distribution of catches
within that survey only, and confirm that they are most frequently
caught in the Strait of Georgia, major stat area <code>"01"</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ssid</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">major_stat_area_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>individuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">catch_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">catch_weight</span><span class="op">)</span>,</span>
<span>            events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fishing_event_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">individuals</span>, <span class="op">-</span><span class="va">weight</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 8 x 4</span></span>
<span><span class="co">#&gt;   major_stat_area_code individuals weight events</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 01                           137     NA     43</span></span>
<span><span class="co">#&gt; 2 06                            14     NA    831</span></span>
<span><span class="co">#&gt; 3 03                            10     NA    383</span></span>
<span><span class="co">#&gt; 4 04                            10     NA    262</span></span>
<span><span class="co">#&gt; 5 07                             2     NA    757</span></span>
<span><span class="co">#&gt; 6 05                             1     NA    362</span></span>
<span><span class="co">#&gt; 7 09                             1     NA    201</span></span>
<span><span class="co">#&gt; 8 08                             0      0    439</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="what-survey-samples-are-available-for-a-species-within-a-specific-area">What survey samples are available for a species within a specific
area?<a class="anchor" aria-label="anchor" href="#what-survey-samples-are-available-for-a-species-within-a-specific-area"></a>
</h3>
<p>As an example, we might want to determine what survey sample data
exists for Pacific Spiny Dogfish in the Strait of Georgia. The area
argument is <code>major</code> and accepts character vectors of major
stat area codes. A table of options can be retrieved with
<code>get_major_area()</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_all.html">get_all_survey_samples</a></span><span class="op">(</span><span class="st">"north pacific spiny dogfish"</span>,</span>
<span>                             major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "Returning all north pacific spiny dogfish specimens from major area(s) 01 from any survey series."</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_series_id</span>, <span class="va">survey_series_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>specimens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">specimen_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            lengths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            age_structures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">age_specimen_collected</span><span class="op">)</span></span>
<span>            <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">specimens</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 15 x 6</span></span>
<span><span class="co">#&gt; # Groups:   ssid [15]</span></span>
<span><span class="co">#&gt;     ssid survey_series_desc                                 specimens lengths weights age_structures</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;                                                  &lt;int&gt;   &lt;int&gt;   &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1    76 "Strait of Georgia Dogfish Longline"                   54716   54690    6582          19053</span></span>
<span><span class="co">#&gt;  2    40 "Hard Bottom Longline Inside South "                   36566   36561       3              0</span></span>
<span><span class="co">#&gt;  3    39 "Hard Bottom Longline Inside North "                   35624   35497     408            400</span></span>
<span><span class="co">#&gt;  4    48 "Dogfish Gear/Timing Comparison Surveys"               16695   16681    3322            884</span></span>
<span><span class="co">#&gt;  5    45 "Strait of Georgia Synoptic Bottom Trawl"               1721    1721    1243            505</span></span>
<span><span class="co">#&gt;  6    15 "Strait of Georgia Lingcod Young-of-year Bottom T~      1371    1181       0              0</span></span>
<span><span class="co">#&gt;  7    34 "Strait of Georgia Ecosystem Research Initiative ~       925     877     402              0</span></span>
<span><span class="co">#&gt;  8    50 "Yelloweye Rockfish Genetics"                            786     786       0              0</span></span>
<span><span class="co">#&gt;  9    87 "Jig Survey - 4B Stat Area 19"                           314     300       0              0</span></span>
<span><span class="co">#&gt; 10    86 "Jig Survey - 4B Stat Area 18"                           176     164       0              0</span></span>
<span><span class="co">#&gt; 11    51 "Combined Submersible And Longline Fishing Survey"       169     169     168              0</span></span>
<span><span class="co">#&gt; 12    82 "Jig Survey - 4B Stat Area 12"                            14      14       0              0</span></span>
<span><span class="co">#&gt; 13    85 "Jig Survey - 4B Stat Area 16"                             5       4       0              0</span></span>
<span><span class="co">#&gt; 14    68 "Joint Canada/US Hake Acoustic"                            1       1       1              0</span></span>
<span><span class="co">#&gt; 15    84 "Jig Survey - 4B Stat Area 15"                             1       0       0              0</span></span></code></pre>
<p>This should return all fishery-independent specimen records. We
haven’t counted actual ages for this species, because none are
available. For both <code>get_all_*</code> functions, the default is to
drop all columns with no data, so in this case the column named
<code>age</code> is missing. However, this column could have been
retained by using the argument <code>drop_na_columns = FALSE</code>.</p>
<p>If you want to focus on specimens that come from design-based survey
sets you can add arguments that filter for unsorted random samples that
come from events that have grouping codes that match those expected for
the current survey design. Alternatively, this can be achieved by
filtering for specimens where <code>!is.na(grouping_code)</code> or
<code>!is.na(grouping_code_updated)</code> and checking that the
<code>sample_type_comment</code> and <code>sample_source_desc</code>
notes are consistent with the specimens being from random samples. Here,
we will use the built in filter arguments, but also add the additional
constraint of filtering based on the updated grouping codes. Note: Some
surveys do not use grouping codes, and therefore won’t be returned when
the <code>grouping_only</code> option is used. In this case, all of SSID
<code>51</code> and <code>82:87</code> are now missing.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_all.html">get_all_survey_samples</a></span><span class="op">(</span><span class="st">"north pacific spiny dogfish"</span>,</span>
<span>                             major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01"</span><span class="op">)</span>,</span>
<span>                             usability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                             unsorted_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             random_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             grouping_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "Looking for samples that are usable (0, 1, 2, 6) unsorted random with originally specified grouping codes."</span></span>
<span><span class="co">#&gt; [1] "Returning all north pacific spiny dogfish specimens from major area(s) 01 from any survey series."</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">grouping_code_updated</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_series_id</span>, <span class="va">survey_series_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>specimens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">specimen_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            lengths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            age_structures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">age_specimen_collected</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">specimens</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 7 x 6</span></span>
<span><span class="co">#&gt; # Groups:   ssid [7]</span></span>
<span><span class="co">#&gt;    ssid survey_series_desc                                  specimens lengths weights age_structures</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;                                                   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1    40 "Hard Bottom Longline Inside South "                    35070   35065       3              0</span></span>
<span><span class="co">#&gt; 2    39 "Hard Bottom Longline Inside North "                    29149   29027     399            400</span></span>
<span><span class="co">#&gt; 3    76 "Strait of Georgia Dogfish Longline"                    18384   18376       0          15521</span></span>
<span><span class="co">#&gt; 4    45 "Strait of Georgia Synoptic Bottom Trawl"                1721    1721    1243            505</span></span>
<span><span class="co">#&gt; 5    15 "Strait of Georgia Lingcod Young-of-year Bottom Tr~      1071    1071       0              0</span></span>
<span><span class="co">#&gt; 6    34 "Strait of Georgia Ecosystem Research Initiative A~       215     215       0              0</span></span>
<span><span class="co">#&gt; 7    68 "Joint Canada/US Hake Acoustic"                             1       1       1              0</span></span></code></pre>
<p>If you want to retrieve additional event or skate-level covariates
for use in model-based analyses, than use the argument
<code>include_event_info = TRUE</code>. For example, when this is
applied to the various longline surveys in the Strait of Georgia, one
can test the effects of variables like depth, date, hook type and size
on the sex and sizes of fish caught.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_all.html">get_all_survey_samples</a></span><span class="op">(</span><span class="st">"north pacific spiny dogfish"</span>,</span>
<span>                             major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01"</span><span class="op">)</span>,</span>
<span>                             ssid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">39</span>, <span class="fl">40</span>, <span class="fl">48</span>, <span class="fl">76</span><span class="op">)</span>,</span>
<span>                             include_event_info <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "Returning all north pacific spiny dogfish specimens from within major area(s) 01 and belonging to survey series 39, 40, 48, 76."</span></span>
<span><span class="co">#&gt; [1] "Specimens found. Fetching additional event info."</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d4</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_series_id</span>, <span class="va">activity_desc</span>, <span class="va">hook_desc</span>, <span class="va">hooksize_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>specimens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">specimen_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">specimens</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span>, hooksize <span class="op">=</span> <span class="va">hooksize_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 8 x 6</span></span>
<span><span class="co">#&gt; # Groups:   ssid, activity_desc, hook_desc [7]</span></span>
<span><span class="co">#&gt;    ssid activity_desc                                   hook_desc   hooksize specimens years      </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;                                           &lt;chr&gt;       &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1    40 HARD BOTTOM LONGLINE HOOK SURVEY - INSIDE SOUTH CIRCLE HOOK 13/0         36566 2005 - 2022</span></span>
<span><span class="co">#&gt; 2    76 STRAIT OF GEORGIA DOGFISH LONGLINE SURVEY       CIRCLE HOOK 14/0         36332 2005 - 2019</span></span>
<span><span class="co">#&gt; 3    39 HARD BOTTOM LONGLINE HOOK SURVEY - INSIDE NORTH CIRCLE HOOK 13/0         35624 2003 - 2023</span></span>
<span><span class="co">#&gt; 4    76 STRAIT OF GEORGIA DOGFISH LONGLINE SURVEY       J-HOOK      12/0         18384 1986 - 1989</span></span>
<span><span class="co">#&gt; 5    48 DOGFISH GEAR/TIMING COMPARISON SURVEYS          CIRCLE HOOK 14/0          8474 2004 - 2023</span></span>
<span><span class="co">#&gt; 6    48 DOGFISH GEAR/TIMING COMPARISON SURVEYS          CIRCLE HOOK 13/0          7254 2019 - 2023</span></span>
<span><span class="co">#&gt; 7    48 DOGFISH GEAR/TIMING COMPARISON SURVEYS          J-HOOK      12/0           948 2004 - 2023</span></span>
<span><span class="co">#&gt; 8    48 DOGFISH GEAR/TIMING COMPARISON SURVEYS          &lt;NA&gt;        &lt;NA&gt;            19 2004 - 2004</span></span></code></pre>
<p>These are the variables returned by default:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Rows: 149,084</span></span>
<span><span class="co">#&gt; Columns: 50</span></span>
<span><span class="co">#&gt; $ species_common_name          &lt;chr&gt; "north pacific spiny dogfish", "north pacific spiny dogfish",~</span></span>
<span><span class="co">#&gt; $ survey_series_id             &lt;dbl&gt; 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 1~</span></span>
<span><span class="co">#&gt; $ sex                          &lt;dbl&gt; 1, 2, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 1, 2~</span></span>
<span><span class="co">#&gt; $ length                       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ weight                       &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ survey_series_og             &lt;dbl&gt; 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 1~</span></span>
<span><span class="co">#&gt; $ activity_desc                &lt;chr&gt; "STRAIT OF GEORGIA LINGCOD YOUNG-OF-YEAR BOTTOM TRAWL SURVEY"~</span></span>
<span><span class="co">#&gt; $ activity_code                &lt;dbl&gt; 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 3~</span></span>
<span><span class="co">#&gt; $ fishing_event_id             &lt;dbl&gt; 3132875, 3132875, 3132875, 3132875, 3132875, 3132875, 3132875~</span></span>
<span><span class="co">#&gt; $ trip_year                    &lt;int&gt; 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2~</span></span>
<span><span class="co">#&gt; $ sample_date                  &lt;dttm&gt; 2006-08-04, 2006-08-04, 2006-08-04, 2006-08-04, 2006-08-04, ~</span></span>
<span><span class="co">#&gt; $ species_code                 &lt;chr&gt; "044", "044", "044", "044", "044", "044", "044", "044", "044"~</span></span>
<span><span class="co">#&gt; $ species_science_name         &lt;chr&gt; "squalus suckleyi", "squalus suckleyi", "squalus suckleyi", "~</span></span>
<span><span class="co">#&gt; $ specimen_id                  &lt;dbl&gt; 12291537, 12291539, 12291540, 12291542, 12291543, 12291544, 1~</span></span>
<span><span class="co">#&gt; $ sample_id                    &lt;dbl&gt; 399729, 399729, 399729, 399729, 399729, 399729, 399729, 39972~</span></span>
<span><span class="co">#&gt; $ fork_length                  &lt;dbl&gt; 72, 72, 73, 74, 75, 75, 76, 80, 85, 88, 89, 70, 77, 77, 78, 7~</span></span>
<span><span class="co">#&gt; $ total_length                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ maturity_code                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</span></span>
<span><span class="co">#&gt; $ maturity_name                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ maturity_desc                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ maturity_convention_code     &lt;dbl&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9~</span></span>
<span><span class="co">#&gt; $ maturity_convention_desc     &lt;chr&gt; "MATURITIES NOT LOOKED AT", "MATURITIES NOT LOOKED AT", "MATU~</span></span>
<span><span class="co">#&gt; $ maturity_convention_maxvalue &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</span></span>
<span><span class="co">#&gt; $ major_stat_area_code         &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", "01", "01", "01", "~</span></span>
<span><span class="co">#&gt; $ major_stat_area_name         &lt;chr&gt; "4B: STRAIT OF GEORGIA", "4B: STRAIT OF GEORGIA", "4B: STRAIT~</span></span>
<span><span class="co">#&gt; $ minor_stat_area_code         &lt;chr&gt; "14", "14", "14", "14", "14", "14", "14", "14", "14", "14", "~</span></span>
<span><span class="co">#&gt; $ gear                         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</span></span>
<span><span class="co">#&gt; $ reason_desc                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ survey_id                    &lt;int&gt; 481, 481, 481, 481, 481, 481, 481, 481, 481, 481, 481, 481, 4~</span></span>
<span><span class="co">#&gt; $ trip_id                      &lt;dbl&gt; 73330, 73330, 73330, 73330, 73330, 73330, 73330, 73330, 73330~</span></span>
<span><span class="co">#&gt; $ trip_sub_type_code           &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2~</span></span>
<span><span class="co">#&gt; $ fe_parent_event_id           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ fe_major_level_id            &lt;dbl&gt; 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 4~</span></span>
<span><span class="co">#&gt; $ fe_sub_level_id              &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ sample_type_code             &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</span></span>
<span><span class="co">#&gt; $ sample_type_comment          &lt;chr&gt; "TOTAL  CATCH", "TOTAL  CATCH", "TOTAL  CATCH", "TOTAL  CATCH~</span></span>
<span><span class="co">#&gt; $ species_category_code        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</span></span>
<span><span class="co">#&gt; $ sample_source_code           &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</span></span>
<span><span class="co">#&gt; $ age_specimen_collected       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</span></span>
<span><span class="co">#&gt; $ usability_code               &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~</span></span>
<span><span class="co">#&gt; $ grouping_code                &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 1~</span></span>
<span><span class="co">#&gt; $ grouping_desc                &lt;chr&gt; "Lingcod YOY depth stratum 1: 16 - 25 m", "Lingcod YOY depth ~</span></span>
<span><span class="co">#&gt; $ grouping_code_updated        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ grouping_desc_updated        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ original_ind                 &lt;chr&gt; "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "~</span></span>
<span><span class="co">#&gt; $ length_type                  &lt;chr&gt; "total_length", "total_length", "total_length", "total_length~</span></span>
<span><span class="co">#&gt; $ sample_source_desc           &lt;chr&gt; "Unsorted", "Unsorted", "Unsorted", "Unsorted", "Unsorted", "~</span></span>
<span><span class="co">#&gt; $ usability_desc               &lt;chr&gt; "FULLY USABLE", "FULLY USABLE", "FULLY USABLE", "FULLY USABLE~</span></span>
<span><span class="co">#&gt; $ survey_series_desc           &lt;chr&gt; "Strait of Georgia Lingcod Young-of-year Bottom Trawl", "Stra~</span></span>
<span><span class="co">#&gt; $ survey_abbrev                &lt;chr&gt; "OTHER", "OTHER", "OTHER", "OTHER", "OTHER", "OTHER", "OTHER"~</span></span></code></pre>
<p>And these additional variables were returned for longline surveys
when <code>include_event_info = TRUE</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">d4</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d4</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Rows: 143,601</span></span>
<span><span class="co">#&gt; Columns: 34</span></span>
<span><span class="co">#&gt; $ catch_weight         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ catch_count          &lt;dbl&gt; 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 53, 5~</span></span>
<span><span class="co">#&gt; $ year                 &lt;int&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 202~</span></span>
<span><span class="co">#&gt; $ month                &lt;int&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, ~</span></span>
<span><span class="co">#&gt; $ day                  &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, ~</span></span>
<span><span class="co">#&gt; $ time_deployed        &lt;dttm&gt; 2023-09-02 14:43:16, 2023-09-02 14:43:16, 2023-09-02 14:43:16, 2023-~</span></span>
<span><span class="co">#&gt; $ time_retrieved       &lt;dttm&gt; 2023-09-02 16:42:55, 2023-09-02 16:42:55, 2023-09-02 16:42:55, 2023-~</span></span>
<span><span class="co">#&gt; $ time_end_deployment  &lt;dttm&gt; 2023-09-02 14:43:16, 2023-09-02 14:43:16, 2023-09-02 14:43:16, 2023-~</span></span>
<span><span class="co">#&gt; $ time_begin_retrieval &lt;dttm&gt; 2023-09-02 16:42:55, 2023-09-02 16:42:55, 2023-09-02 16:42:55, 2023-~</span></span>
<span><span class="co">#&gt; $ latitude             &lt;dbl&gt; 50.21935, 50.21935, 50.21935, 50.21935, 50.21935, 50.21935, 50.21935,~</span></span>
<span><span class="co">#&gt; $ longitude            &lt;dbl&gt; -125.3644, -125.3644, -125.3644, -125.3644, -125.3644, -125.3644, -12~</span></span>
<span><span class="co">#&gt; $ latitude_end         &lt;dbl&gt; 50.22198, 50.22198, 50.22198, 50.22198, 50.22198, 50.22198, 50.22198,~</span></span>
<span><span class="co">#&gt; $ longitude_end        &lt;dbl&gt; -125.3671, -125.3671, -125.3671, -125.3671, -125.3671, -125.3671, -12~</span></span>
<span><span class="co">#&gt; $ depth_m              &lt;dbl&gt; 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 79, 7~</span></span>
<span><span class="co">#&gt; $ depth_begin          &lt;dbl&gt; 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 6~</span></span>
<span><span class="co">#&gt; $ depth_end            &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101,~</span></span>
<span><span class="co">#&gt; $ vessel_id            &lt;dbl&gt; 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 201~</span></span>
<span><span class="co">#&gt; $ captain_id           &lt;dbl&gt; 969, 969, 969, 969, 969, 969, 969, 969, 969, 969, 969, 969, 969, 969,~</span></span>
<span><span class="co">#&gt; $ duration_min         &lt;int&gt; 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119, 119,~</span></span>
<span><span class="co">#&gt; $ tow_length_m         &lt;dbl&gt; 350, 350, 350, 350, 350, 350, 350, 350, 350, 350, 350, 350, 350, 350,~</span></span>
<span><span class="co">#&gt; $ hook_code            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~</span></span>
<span><span class="co">#&gt; $ lglsp_hook_count     &lt;dbl&gt; 225, 225, 225, 225, 225, 225, 225, 225, 225, 225, 225, 225, 225, 225,~</span></span>
<span><span class="co">#&gt; $ hook_desc            &lt;chr&gt; "CIRCLE HOOK", "CIRCLE HOOK", "CIRCLE HOOK", "CIRCLE HOOK", "CIRCLE H~</span></span>
<span><span class="co">#&gt; $ hooksize_desc        &lt;chr&gt; "13/0", "13/0", "13/0", "13/0", "13/0", "13/0", "13/0", "13/0", "13/0~</span></span>
<span><span class="co">#&gt; $ grouping_depth_id    &lt;chr&gt; "2", "2", "2", "2", "2", "2", "2", "2", "2", "2", "2", "2", "2", "2",~</span></span>
<span><span class="co">#&gt; $ grouping_area_km2    &lt;int&gt; 844, 844, 844, 844, 844, 844, 844, 844, 844, 844, 844, 844, 844, 844,~</span></span>
<span><span class="co">#&gt; $ skate_count          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~</span></span>
<span><span class="co">#&gt; $ mean_per_skate       &lt;dbl&gt; 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236,~</span></span>
<span><span class="co">#&gt; $ minor_id_count       &lt;int&gt; 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236,~</span></span>
<span><span class="co">#&gt; $ minor_id_max         &lt;dbl&gt; 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236,~</span></span>
<span><span class="co">#&gt; $ diff                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~</span></span>
<span><span class="co">#&gt; $ event_level_count    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ skate_id             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~</span></span>
<span><span class="co">#&gt; $ hook_area_swept_km2  &lt;dbl&gt; 0.005262028, 0.005262028, 0.005262028, 0.005262028, 0.005262028, 0.00~</span></span></code></pre>
<p>The collection of variables that are returned can change depending on
the records that are retrieved. For example, variables that are specific
to longline surveys are omitted when only trawl survey sets are
returned.</p>
</div>
<div class="section level3">
<h3 id="surveys-with-overlapping-stratifications">Surveys with overlapping stratifications<a class="anchor" aria-label="anchor" href="#surveys-with-overlapping-stratifications"></a>
</h3>
<p>Some fishing events are assigned to multiple surveys, which may or
may not be fully or partially overlapping, and are defined by the same
activity code in the database. To get all sets with matching activity
codes one can use <code>include_activity_matches = TRUE</code>. It will
return all events that share the same <code>activity_code</code> as any
SSIDs requested. This works when retrieving either sets or samples.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_all.html">get_all_survey_sets</a></span><span class="op">(</span><span class="st">"north pacific spiny dogfish"</span>,</span>
<span>                          ssid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>                          include_activity_matches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          remove_duplicates <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">#&gt; default</span></span>
<span>                          <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "north pacific spiny dogfish have been recorded by survey series 7, 6, 67 at least once. "</span></span>
<span><span class="co">#&gt; [1] "Returning all relevant sets/events/skates including those with no catch."</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning in get_all_survey_sets("north pacific spiny dogfish", ssid = c(7), : Duplicate</span></span>
<span><span class="co">#&gt; fishing_event_ids are still present despite `remove_duplicates = TRUE`. This may be because of</span></span>
<span><span class="co">#&gt; overlapping survey stratifications or multiple skates per event (specifically when at least one</span></span>
<span><span class="co">#&gt; survey included used skates with differences in gear type), but could also be due to trips</span></span>
<span><span class="co">#&gt; participating in more than one type of survey. If the latter, location, gear, or `reason_desc`</span></span>
<span><span class="co">#&gt; columns should be used to choose which events to keep. After selecting specific survey</span></span>
<span><span class="co">#&gt; stratifications and determining that all relevant variables are accurate, the remaining</span></span>
<span><span class="co">#&gt; duplications can be filtered using `dat &lt;- dat[!duplicated(dat$fishing_event_id), ]`.</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d5</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_series_id</span>, <span class="va">survey_abbrev</span>, <span class="va">activity_desc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fishing_event_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">events</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ssid <span class="op">=</span> <span class="va">survey_series_id</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # A tibble: 2 x 6</span></span>
<span><span class="co">#&gt; # Groups:   ssid, survey_abbrev [2]</span></span>
<span><span class="co">#&gt;    ssid survey_abbrev activity_desc                                            events years     rows</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;                                                     &lt;int&gt; &lt;chr&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     7 MSSM WCVI     MULTISPECIES SMALL-MESH (AKA SHRIMP) BOTTOM TRAWL SURVEY   5084 1975 - ~  5084</span></span>
<span><span class="co">#&gt; 2     6 MSSM QCS      MULTISPECIES SMALL-MESH (AKA SHRIMP) BOTTOM TRAWL SURVEY   1295 1998 - ~  1295</span></span></code></pre>
<p>You will get a warning that some fishing events are duplicated even
though <code>remove_duplicates = TRUE</code>. We can look at one of the
duplicated events and see that it lacks location information, which
means that it couldn’t be accurately assigned to either region of shrimp
survey, so it has been returned as potentially belonging to both.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="va">d5</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">d5</span><span class="op">$</span><span class="va">fishing_event_id</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 54</span></span>
<span><span class="co">#&gt; $ species_common_name   &lt;chr&gt; "north pacific spiny dogfish"</span></span>
<span><span class="co">#&gt; $ catch_count           &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ catch_weight          &lt;dbl&gt; 1.9</span></span>
<span><span class="co">#&gt; $ survey_series_id      &lt;dbl&gt; 7</span></span>
<span><span class="co">#&gt; $ survey_abbrev         &lt;chr&gt; "MSSM WCVI"</span></span>
<span><span class="co">#&gt; $ year                  &lt;int&gt; 2000</span></span>
<span><span class="co">#&gt; $ fishing_event_id      &lt;dbl&gt; 901698</span></span>
<span><span class="co">#&gt; $ species_code          &lt;chr&gt; "044"</span></span>
<span><span class="co">#&gt; $ fe_major_level_id     &lt;dbl&gt; 9</span></span>
<span><span class="co">#&gt; $ trip_id               &lt;dbl&gt; 60021</span></span>
<span><span class="co">#&gt; $ survey_series_og      &lt;dbl&gt; 7</span></span>
<span><span class="co">#&gt; $ activity_desc         &lt;chr&gt; "MULTISPECIES SMALL-MESH (AKA SHRIMP) BOTTOM TRAWL SURVEY"</span></span>
<span><span class="co">#&gt; $ activity_code         &lt;dbl&gt; 25</span></span>
<span><span class="co">#&gt; $ reason_desc           &lt;chr&gt; "QUANT. BIOMASS SURVEY"</span></span>
<span><span class="co">#&gt; $ trip_year             &lt;int&gt; 2000</span></span>
<span><span class="co">#&gt; $ month                 &lt;int&gt; NA</span></span>
<span><span class="co">#&gt; $ day                   &lt;int&gt; NA</span></span>
<span><span class="co">#&gt; $ time_deployed         &lt;dttm&gt; NA</span></span>
<span><span class="co">#&gt; $ time_retrieved        &lt;dttm&gt; NA</span></span>
<span><span class="co">#&gt; $ time_end_deployment   &lt;dttm&gt; NA</span></span>
<span><span class="co">#&gt; $ time_begin_retrieval  &lt;dttm&gt; NA</span></span>
<span><span class="co">#&gt; $ latitude              &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ longitude             &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ latitude_end          &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ longitude_end         &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ major_stat_area_code  &lt;chr&gt; "00"</span></span>
<span><span class="co">#&gt; $ minor_stat_area_code  &lt;chr&gt; "00"</span></span>
<span><span class="co">#&gt; $ depth_m               &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ depth_begin           &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ depth_end             &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ vessel_id             &lt;dbl&gt; 2000</span></span>
<span><span class="co">#&gt; $ captain_id            &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ duration_min          &lt;int&gt; NA</span></span>
<span><span class="co">#&gt; $ tow_length_m          &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ mouth_width_m         &lt;dbl&gt; 10.6</span></span>
<span><span class="co">#&gt; $ doorspread_m          &lt;dbl&gt; 29.6</span></span>
<span><span class="co">#&gt; $ speed_mpm             &lt;dbl&gt; 86.66668</span></span>
<span><span class="co">#&gt; $ usability_code        &lt;dbl&gt; 13</span></span>
<span><span class="co">#&gt; $ grouping_code         &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ grouping_desc         &lt;chr&gt; NA</span></span>
<span><span class="co">#&gt; $ grouping_code_updated &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ grouping_desc_updated &lt;chr&gt; NA</span></span>
<span><span class="co">#&gt; $ grouping_area_km2     &lt;int&gt; NA</span></span>
<span><span class="co">#&gt; $ original_ind          &lt;chr&gt; "Y"</span></span>
<span><span class="co">#&gt; $ survey_series_desc    &lt;chr&gt; "West Coast Vancouver Island Multispecies Small-mesh Bottom Trawl"</span></span>
<span><span class="co">#&gt; $ species_science_name  &lt;chr&gt; "squalus suckleyi"</span></span>
<span><span class="co">#&gt; $ species_desc          &lt;chr&gt; "north pacific spiny dogfish"</span></span>
<span><span class="co">#&gt; $ usability_desc        &lt;chr&gt; "UNUSABLE FOR CPUE ESTIMATION"</span></span>
<span><span class="co">#&gt; $ area_swept1           &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ area_swept2           &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ area_swept            &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ area_swept_km2        &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ density_kgpm2         &lt;dbl&gt; NA</span></span>
<span><span class="co">#&gt; $ density_pcpm2         &lt;dbl&gt; NA</span></span></code></pre>
<p>NOTE: All activity matches are always returned by default whenever
any one of the sablefish surveys (ssid = 35, 41, 42, 43) is requested.
This is because SSIDs for that survey were inconsistently assigned and
frequently share trip ids, which results in duplication and or
assignment to the wrong survey series. In order to accurately separate
the types of sablefish surveys one needs to split data from this survey
by the <code>reason_desc</code> variable.</p>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="beware-of-duplication-of-fishing-events-and-specimens">Beware of duplication of fishing events and specimens<a class="anchor" aria-label="anchor" href="#beware-of-duplication-of-fishing-events-and-specimens"></a>
</h3>
<p>A risk in using <code>get_all_*()</code> functions is that, in the
attempt to return a comprehensive data set, some fishing events and
specimen ids may be duplicated (this also occurs with the original
functions but usually for different reasons). Some vessel trips conduct
sampling for multiple survey series, and unless joining is based on
grouping codes (which aren’t used consistently for some surveys) the
only way to connect a fishing event to a survey series id is through the
vessel trip. This can result in events and specimens getting assigned to
both surveys that were conducted on the same trip. The most common
instances of this (e.g., sablefish, jig, and offshore shrimp surveys)
have custom corrections coded into an internal function
<code>correct_ssids()</code> that is applied within the
<code>get_all_*()</code> functions. Duplication can also occur due to
missing covariates (e.g., both event level and survey defaults are
missing for <code>doorspread_m</code> on a couple sets for some trawl
survey series), or for specimens when multiple vials of DNA were
collected and <code>return_dna_info = TRUE</code>. It is recommended to
always check for unexpected duplication of observations (usually
<code>fishing_event_id</code> or <code>specimen_id</code>) before
beginning any analysis. Two return both copies of each duplicated record
the following can be used:
<code>d[duplicated(d$specimen_id) | duplicated(d$specimen_id, fromLast=TRUE), ]</code>.</p>
</div>
<div class="section level3">
<h3 id="error-messages">Error messages<a class="anchor" aria-label="anchor" href="#error-messages"></a>
</h3>
<p>Any error message that mentions SQL Server suggests either that the
network connection or server timed out, or that the SQL query was
flawed. One way this can happen is providing an invalid ssid (e.g., a
character “4” instead of a numeric 4), invalid major area code (e.g., a
numeric 1 instead of a character “01”), or a search that is
insufficiently limited in its scope.</p>
<blockquote>
<p>Error: nanodbc/nanodbc.cpp:2823: 08S01 [Microsoft][ODBC SQL Server
Driver][DBNETLIB]ConnectionRead (recv()). [Microsoft][ODBC SQL Server
Driver][DBNETLIB]General network error. Check your network
documentation.</p>
</blockquote>
<p>If the SQL search is successfully returned to R, but your computer
has insufficient memory to handle the amount of data returned, you may
see an error like this:</p>
<blockquote>
<p>Error: cannot allocate vector of size XXX Mb</p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elise A. Keppel, Philina A. English, Sean C. Anderson, Andrew M. Edwards, Chris Grandin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
